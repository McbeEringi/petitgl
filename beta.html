<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<body>
		<style>:root{background:#222;color:#fff;}</style>
		<a href="https://mcbeeringi.github.io/petitgl/petitgl.js">PetitGL</a>
		<script src="beta.js"></script>
		<script>
		let btex=0;
			const t0=new Date();
				main=new PetitGL(undefined,[.5,.5,.5,0])
				.resize(800,512)
				.tex(
					[
						{name:'texture0',url:'img/corn.png'}
					]
				)
				.buffer(
					[
						{name:'buff0',tex:'btex0'},
						{name:'buff1',tex:'btex1'}
					]
				)
				.compile(
					'test',//program name
					`attribute vec2 UV;void main(){gl_Position=vec4(UV,0,1);}`,//vsh
					`precision mediump float;uniform highp float time;uniform vec2 res;
					uniform sampler2D tex0;uniform vec2 tex0res;uniform sampler2D buffer;
					void main(){
						vec4 prev=texture2D(buffer,gl_FragCoord.xy/res);
						vec4 now=texture2D(tex0,fract((gl_FragCoord.xy+vec2(time*3.141593+cos(time*4.),sin(time*4.))*32.)/tex0res));
						gl_FragColor=mix(prev,now,now.a)-.01;
					}`//fsh
				)
				.defAtt(
					'test',
					[
						'UV'
					]
				)
				.att(
					[
						{name:'_uv',data:[-1,-1, 1,-1, -1,1, 1,1],slice:2}
					]
				)
				.ibo([
					{name:'ibo',data:[0,1,2, 3,2,1]}
				])
				.defUni(
					'test',
					[
						'time',
						'tex0',
						'tex0res',
						'res',
						'buffer',
					]
				),
				loop=()=>{
					requestAnimationFrame(loop);
					main
					.uni(
						'test',
						[
							{loc:'time',data:[(new Date()-t0)*.001],type:'f'},
							{loc:'tex0',data:'texture0',rname:'tex0res'},
							{loc:'res',data:[main.c.width,main.c.height],type:'f'},
							{loc:'buffer',data:'btex'+Number(btex)}
						]
					)
					.draw('test',[{loc:'UV',att:'_uv'}],'ibo').flush()
					.draw('test',[{loc:'UV',att:'_uv'}],'ibo','buff'+Number(!btex));
					btex=!btex;
				};loop();
				document.body.appendChild(main.c);
		</script>
	</body>
</html>
