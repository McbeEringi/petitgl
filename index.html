<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<body>
		<style>
			:root{background:#000;color:#fff;font-family:monospace;}
			a:link,a:visited{color:#aef;}a:hover{color:#8af;}a:active{color:#48f;}
			canvas{position:fixed;top:0;left:0;z-index:-1;}
		</style>
		<script src="petitgl.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
		<script>
		fetch('README.md').then(x=>x.text()).then(x=>document.body.insertAdjacentHTML('afterbegin',marked(x,{baseUrl:'/'})));
		let btex;
			const t0=new Date();
				main=new PetitGL(undefined,[0,0,0,1])
				.resize(innerWidth,innerHeight)
				.tex([
					{name:'texture0',url:'img/icon.svg'}
				])
				.buffer([
					{name:'buff0',tex:'btex0'},
					{name:'buff1',tex:'btex1'}
				])
				.att([
					{name:'_uv',data:[-1,-1, 1,-1, -1,1, 1,1],slice:2}
				])
				.ibo([
					{name:'ibo',data:[0,1,2, 3,2,1]}
				])
				.compile(
					'test',//program name
					`attribute vec2 UV;void main(){gl_Position=vec4(UV,0,1);}`,//vsh
					`precision mediump float;uniform highp float time;uniform vec2 res;
					uniform sampler2D tex0;uniform vec2 tex0res;uniform sampler2D buffer;
					void main(){
						const float pi=3.141593;
						vec4 prev=texture2D(buffer,gl_FragCoord.xy/res);
						vec4 now=texture2D(tex0,fract((gl_FragCoord.xy+vec2(time*pi*.5+cos(time*pi),sin(time*pi))*32.)/tex0res));
						gl_FragColor=mix(prev*.98,now,now.a);
					}`//fsh
				)
				.defAtt(
					'test',
					[
						'UV'
					]
				)
				.defUni(
					'test',
					[
						'time',
						'tex0',
						'tex0res',
						'res',
						'buffer',
					]
				),
				loop=()=>{
					requestAnimationFrame(loop);
					main
					.uni(
						'test',
						[
							{loc:'time',data:[(new Date()-t0)*.001],type:'f'},
							{loc:'tex0',data:'texture0',rname:'tex0res'},
							{loc:'res',data:[main.c.width,main.c.height],type:'f'},
							{loc:'buffer',data:'btex'+Number(btex)}
						]
					)
					.draw('test',[{loc:'UV',att:'_uv'}],'ibo').flush()
					.draw('test',[{loc:'UV',att:'_uv'}],'ibo','buff'+Number(!btex));
					btex=!btex;
				};
		loop();
		document.body.appendChild(main.c);
		onresize=()=>main.resize(innerWidth,innerHeight).buffer([{name:'buff0',tex:'btex0'},{name:'buff1',tex:'btex1'}]);
		</script>
	</body>
</html>
